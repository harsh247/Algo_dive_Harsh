<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<style id="sip">
.slidecontainer {
  width: 100%;
}

.slider {
  -webkit-appearance: none;
  width: 720px;
  height: 25px;
  outline: none;
  animation: color-range 100s linear forwards paused;
  background: linear-gradient(90deg, green 0%, rgba(0,0,0,0.1) 0%);
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover {
  opacity: 1;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 25px;
  height: 25px;
  border-radius: 50%;
  position: relative;
  /* left:5px; */
  background: white;
  cursor: pointer;
}


.form-input{
    width:250px;
    height:35px;
    border: 2px solid rgba(0,0,255,0.2);
    -webkit-transition: 0.5s;
    transition: 0.2s;
    outline: none;
}

input:focus{
    /* box-sizing: border-box; */
    border-style: solid;
    border-width: 4px;
    border-color:rgba(0, 0, 255,0.2) !important; 
    border-top-color:rgba(0, 0, 255,0.4) !important; 
    border-left-color:rgba(0, 0, 255,0.4) !important;
    border-right-color:rgba(0, 0, 255,0.4) !important;
    border-bottom-color:rgba(0, 0, 255,0.4) !important;   
    /* background-color: yellow; */
}

.slider::-moz-range-thumb {
  width: 25px;
  height: 25px;
  background: #04AA6D;
  cursor: pointer;
}

.input_label{
    font-size: 24px;
     font-family: Arial, Helvetica, sans-serif;
     font-style: bold;
     width:22%;
     display: inline-block;
}

.d-none{
    display: none;
}

.d-block{
    display: block;
}

@media screen and (max-width:992px) {
  .input_label{
    font-size: 24px;
    width:480px;
  }

  .form-input{
    width:250px;
  }
}

@media screen and (max-width:600px) {
  .input_label{
    font-size: 18px;
    width:180px;
  }

  .form-input{
    width:150px;
  }
}

@keyframes color-range {
  0% { color: steelblue }
  100% { color: green }
}
</style>
<script>

function modifyValue(){
let elem = document.getElementById('myRange');
let elem1 = document.getElementById('rangeValue');
elem1.setAttribute("value",elem.value?parseFloat(elem.value):0);

// let total_invested = document.getElementById("total_invested");

// let monthy_inv = document.getElementById("sip_amount").value;
// let duration = document.getElementById("duration").value;

// total_invested.setAttribute("value",monthy_inv*duration);

}

{/* let bar; */}

function calculateEMI(){

    // let graph = document.getElementById("sip-chart");
    // let graph1= document.createElement("canvas");
    // graph1.setAttribute("id",'sip-chart');
    // graph1.setAttribute("style","width:100%;max-width:920px");
    // graph.remove();

    // let body = document.getElementsByTagName("body")[0];
    // body.appendChild(graph1);

    document.getElementById("result").classList.remove('d-none');
    document.getElementById("result").classList.add('d-block');

    let rate = document.getElementById("rangeValue").value;
    let duration = document.getElementById("duration").value;

    let total_invested = document.getElementById("total_invested");

    let loan_amount = document.getElementById("loan_amount").value;

    loan_amount = loan_amount.replaceAll(",","");
    loan_amount = loan_amount.replaceAll("₹","");
    loan_amount = parseInt(loan_amount);
    
    // let total_amount = monthly_inv*duration;

    // total_invested.setAttribute("value",monthly_inv*duration);

    rate = rate/12;
    rate = rate/100;
    duration = duration*12;
    let emi = loan_amount*rate*Math.pow(1+rate,duration)/(Math.pow(1+rate,duration)-1);
    let total_emi = emi*duration;

    document.getElementById("expected").setAttribute("value",formatOutputAmount(emi.toFixed(2)));
    document.getElementById("emi_paid").setAttribute("value",formatOutputAmount(total_emi.toFixed(2)));


//     let chart = document.getElementById('sip-chart');

//     let xValues = [6,6];
//     let colors = ['blue','green'];
//     let barColors=[];
//     while(duration/6>1){	
// 	let val = xValues[xValues.length-1]+6;
// 	xValues.push(val);
// 	xValues.push(val);
//         barColors=[...barColors,...colors];
// 	duration=duration-6;
//     }

   
//    barColors=[...barColors,...colors];

//    let yValues=[];

//    duration = document.getElementById("duration").value;
   
//    let dur=6;
   
//    while(dur<=duration){
//  	let amount = monthly_inv*dur;
// 	let ret = ((Math.pow(1+rate,dur)-1)/rate)*(1+rate)*monthly_inv;
// 	dur+=6;
// 	yValues=[...yValues,amount,ret];
//    }
   
//    if(dur>duration){
//         let amount = monthly_inv*duration;
// 	let ret = ((Math.pow(1+rate,duration)-1)/rate)*(1+rate)*monthly_inv;
// 	yValues=[...yValues,amount,ret];
// }

//  new Chart("sip-chart", {
//   type: "bar",
//   data: {
//     labels: xValues,
//     datasets: [{
//       backgroundColor: barColors,
//       data: yValues
//     }]
//   },
//   options: {
//     legend: {display: false},
//     title: {
//       display: true,
//       text: "SIP analysis"
//     }
//   }
// });


// let legend = document.getElementById('legends');
// legend.setAttribute("style","display:block;padding:30px");

}

let setColor = (el) => {
  el.style.animationDelay = `-${el.value}s`;
  el.style.background = `linear-gradient(90deg, rgba(0,0,255,0.6) ${el.value}%, rgba(0,0,0,0.1) ${el.value}%)`;
};

function setSlider(value){
    let el = document.getElementById("myRange");
    el.style.animationDelay = `-${value}s`;
    let sheet = document.getElementById("sip");
    // let thumb = sheet.querySelector('slider::-webkit-slider-thumb');
    el.setAttribute("value",value?`${value}`:`0`);
    el.style.background = `linear-gradient(90deg, rgba(0,0,255,0.6) ${value}%, rgba(0,0,0,0.1) ${value}%)`;
}

function formatAmount(event,tag_id){

let val = event.target.value;
val = val.replaceAll(",","");
val = val.replaceAll("₹","");
val = val.replaceAll(" ","");


let elem = document.getElementById(tag_id);
if(isNaN(parseFloat(val))){
    // event.preventDefault();
    // elem.setAttribute("value","&#8377;0.00");
    event.target.value = "₹";
}else{
    let str = '';
    val = parseFloat(val);
    val = val.toFixed(0);
    let s = val.toString();
    let s1 = "";
    let n = s.length-1;

    if(n>=3){
        n+=1;
    }

    if(n>=5){
        n+=1;
    }

    if(n>=7){
        n+=1;
    }

    if(n>=9){
        n+=1;
    }

    if(n>=11){
        n+=1;
    }


    let count = 0;
    let format = '00,00,00,00,000';
    let ss = s.split("").reverse().join("");
    for(let i=0;i<=n;i++){         
        if(format.charAt(format.length-i-1)==','){
            // let ss = s.split("").reverse().join("");
            if(ss.substr(i,ss.length-i)!=''){
            s1 = ss.substr(0,i)+","+ss.substr(i,ss.length-i);
            ss = s1;
            }
        }
    }
    if(s1 ==''){
        s1 = ss;
    }
    s1 = s1.split("").reverse().join("");
    // elem.setAttribute("value","&#8377;"+s1);
    event.target.value = `₹${s1}`;
}
}

function formatOutputAmount(amount){

let val = amount;
// val = val.replaceAll(",","");
// val = val.replaceAll("₹","");
// val = val.replaceAll(" ","");


// let elem = document.getElementById(tag_id);
if(isNaN(parseFloat(val))){
// event.preventDefault();
// elem.setAttribute("value","&#8377;0.00");
event.target.value = "₹";
}else{
let str = '';
val = parseFloat(val);
val = val.toFixed(2);
let s = val.toString();
let s1 = "";
let n = s.length-1;

if(n>=6){
n+=1;
}

if(n>=8){
n+=1;
}

if(n>=10){
n+=1;
}

if(n>=12){
n+=1;
}

if(n>=14){
n+=1;
}


let count = 0;
let format = '00,00,00,00,000.00';
let ss = s.split("").reverse().join("");
for(let i=0;i<=n;i++){         
if(format.charAt(format.length-i-1)==','){
    // let ss = s.split("").reverse().join("");
    if(ss.substr(i,ss.length-i)!=''){
    s1 = ss.substr(0,i)+","+ss.substr(i,ss.length-i);
    ss = s1;
    }
}
}
if(s1 ==''){
s1 = ss;
}
s1 = s1.split("").reverse().join("");
s1 = `₹${s1}`;
// elem.setAttribute("value","&#8377;"+s1);
// event.target.value = `₹${s1}`;
return s1;
}
}
</script>
</head>
<body>

<h1>EMI Calculator</h1>

<div style="display:flex;justify-content:flex-start;flex-direction: column;">
<div style="padding:10px 10px;width:100%">
    <label class="input_label">Loan Amount:</label>
    <input id="loan_amount" class="form-input" type="string" onkeyup="formatAmount(event,'total_amount')">
</div>
<div style="padding:10px 10px;width:100%">
    <label class="input_label">Interest Rate (in %) :</label>
    <div style="padding:10px 10px" class="slidecontainer">
    <input type="range" class="slider" name="points" id="myRange" min="1.0" max="100.0" value="0" step="0.1" oninput="setColor(this);modifyValue()">
    </div>
    <input disabled type="number" class="form-input" id="rangeValue" oninput="setSlider(event.target.value)">
</div>
<div style="padding:10px 10px;width:100%">
    <label class="input_label">Tenure (in years):</label>
    <input class="form-input" type="number" id="duration">
</div>
<div style="display: inline-block;">
  <button style="padding:20px 40px; color:white;background-color: grey;opacity:0.8;font-size: 18px;font-family: Arial, Helvetica, sans-serif;font-weight: bold;" onclick="calculateEMI()">Calculate</button>
    <!-- <p>Custom range slider:</p>
    <input type="range" min="1" max="100" value="50" class="slider" id="myRange" onchange="modifyValue()"> -->
</div>
<div id="result" class="d-none">
<!-- <div style="padding:10px 10px">
    <label class="input_label">Loan Amount:</label>
    <input class="form-input" type="number" id="total_invested">
</div> -->
<div style="padding:10px 10px;width:100%">
    <label class="input_label">EMI :</label>
    <input class="form-input" disabled style="background-color: white;" type="string" id="expected">
</div>
<div style="padding:10px 10px;width:100%">
    <label class="input_label">Total EMI paid :</label>
    <input class="form-input" disabled style="background-color: white;" type="string" id="emi_paid">
</div>
</div>
</div>

<!-- <div style="display:none" id="legends">
<div style="background-color:blue;width:60px;height:15px;display:inline-block;"></div>
<label> Loan Amount : </label>
<div style="background-color:green;width:60px;height:15px;display:inline-block;"></div>
<label>Expected Return</label>
</div>

<canvas id="sip-chart" style="width:100%;max-width:920px"></canvas> -->



</body>

</html>